# Управление пользователями

**1) Добавьте пользователей user1 и user2:**

1.1) user1 - оболочка bash
1.2) user2 - оболочка sh
1.3) установите им пароли

```sh
useradd -s [оболочка] -p [пароль] [ник]
```

*Флаги:*
```
-b - базовый каталог для размещения домашнего каталога пользователя, по умолчанию /home;
-c - комментарий к учетной записи;
-d - домашний каталог, в котором будут размещаться файлы пользователя;
-e - дата, когда учетная запись пользователя будет заблокирована, в формате ГГГГ-ММ-ДД;
-f - заблокировать учетную запись сразу после создания;
-g - основная группа пользователя;
-G - список дополнительных групп;
-k - каталог с шаблонами конфигурационных файлов;
-l - не сохранять информацию о входах пользователя в lastlog и faillog;
-m - создавать домашний каталог пользователя, если он не существует;
-M - не создавать домашнюю папку;
-N - не создавать группу с именем пользователя;
-o - разрешить создание пользователя linux с неуникальным идентификатором UID;
-p - задать пароль пользователя;
-r - создать системного пользователя, не имеет оболочки входа, без домашней директории и с идентификатором до SYS_UID_MAX;
-s - командная оболочка для пользователя;
-u - идентификатор для пользователя;
-D - отобразить параметры, которые используются по умолчанию для создания пользователя. Если вместе с этой опцией задать еще какой-либо параметр, то его значение по умолчанию будет переопределено.
```

Решение:

```sh
useradd -s /bin/bash -p test1 user1
useradd -s /bin/sh -p test2 user2
```
Чекаем файлик /etc/passwd, чтобы убедиться в правильности добавления:

![image](https://github.com/user-attachments/assets/bb87573b-2a58-4581-b99e-e88e44e311ef)

**2) Назначьте пользователю 1 группу администраторов, пользователя 2 добавьте в группу пользователя 1.**

```sh
usermod [options] [group] [name]
```

*Флаги:*
```
-a, --append – добавить пользователя в одну или несколько дополнительных групп. Опция будет работать только вместе с опцией -G.
-b, --badnames – разрешить использование имен, которые не соответствуют стандартам.
-d, --home – указать новое местоположение домашнего каталога пользователя. При использовании опции -m содержимое текущего домашнего каталога будет перемещено на новое место.
-e, --expiredate – указать дату, при наступлении которой учетная запись будет отключена. Дата вводится в формате ГГГГ-ММ-ДД. Если использовать эту опцию без указания даты, то отключение пользователя будет отменено.
-f, --inactive – установить количество дней для блокировки пользователя, которое должно пройти после устаревания пароля. При значении -1 опция блокировки отключается, а при значении 0 блокировка случится сразу же после устаревания.
-g, --gid – выбрать новую основную группу для пользователя и для файлов в его домашнем каталоге. Нужно задать имя или номер новой группы.
-G, --groups – указать список дополнительных групп, в которые должен входить пользователь. Между собой группы разделяются запятой. Если пользователь входит в дополнительную группу, которая не была указана в списке, то он будет из нее удалён. Но при использовании опции -a можно добавлять новые дополнительные группы, не удаляя старые.
-l, --login – изменить имя пользователя на новое. Данная опция не затрагивает никакие другие данные. А значит, название домашнего каталога и почты придется изменять вручную, чтобы они совпадали с новым именем пользователя.
-L, --lock – заблокировать пароль пользователя. Эта опция помещает символ ! (восклицательный знак) перед паролем в зашифрованном виде, отключая его. Данную опцию нельзя использовать с -p и -U.
-m, --move-home – изменить местоположение домашнего каталога пользователя. Опция будет работать только вместе с -d. Утилита попытается обновить права собственности на файлы и скопировать режимы, ACL и расширенные атрибуты.
-o, --non-unique – разрешить заменить идентификационный номер пользователя на не уникальное значение. Работает в паре с опцией -u.
-p, --password – изменить пароль в зашифрованном виде.
-R, --root – выполнить chroot в указанный каталог и использовать его вместо корневого каталога / с хранящимися в нем конфигурационными файлами.
-s, --shell – указать новую командную оболочку shell для пользователя. При использовании опции -s с пустым значением будет выбрана оболочка по умолчанию.
-u, --uid – изменить параметр UID (числовой идентификатор пользователя). Данные изменения автоматически применятся к почтовому ящику и содержимому домашнего каталога. Для остальных файлов UID придется изменять вручную.
-U, --unlock – разблокировать пароль пользователя. Данная опция убирает символ ! (восклицательный знак) перед паролем в зашифрованном виде, разрешая использовать его для входа. Не сработает с -p и -L.
```

Решение:

```sh
usermod -aG wheel user1
usermod -aG user1 user2
```

Проверяем, что все получилось, смотря файлик /etc/group:

![image_2024-11-13_22-47-49](https://github.com/user-attachments/assets/c26e7d0e-e143-4fb5-a877-ff29db6a29da)


**3) Что такое права доступа? Выведите права доступа на файлы в директории пользователя.**

Права доступа - функции безопасности, которые позволяют регулировать доступ к файлам и папкам для пользователей и скриптов.

Изначально каждый файл имел три параметра доступа. Вот они:

- Чтение - разрешает получать содержимое файла, но на запись нет. Для каталога позволяет получить список файлов и каталогов, расположенных в нем;
- Запись - разрешает записывать новые данные в файл или изменять существующие, а также позволяет создавать и изменять файлы и каталоги;
- Выполнение - вы не можете выполнить программу, если у нее нет флага выполнения. Этот атрибут устанавливается для всех программ и скриптов, именно с помощью него система может понять, что этот файл нужно запускать как программу.

Но все эти права были бы бессмысленными, если бы применялись сразу для всех пользователей. Поэтому каждый файл имеет три категории пользователей, для которых можно устанавливать различные сочетания прав доступа:

- Владелец - набор прав для владельца файла, пользователя, который его создал или сейчас установлен его владельцем. Обычно владелец имеет все права, чтение, запись и выполнение.
- Группа - любая группа пользователей, существующая в системе и привязанная к файлу. Но это может быть только одна группа и обычно это группа владельца, хотя для файла можно назначить и другую группу.
- Остальные - все пользователи, кроме владельца и пользователей, входящих в группу файла.

```sh
ls -l ~/
```
![image](https://github.com/user-attachments/assets/24deb5f5-6bcb-49c4-95b0-5223a92c6362)


**4) Как изменить права на файлы? Создайте файл, на который у всех пользователей будут всевозможные права.**

```sh
chmod [options] категориядействиефлаг [file]
```

*Флаги:*

```
-c - выводить информацию обо всех изменениях;
-f - не выводить сообщения об ошибках;
-v - выводить максимум информации;
--preserve-root - не выполнять рекурсивные операции для корня "/";
--reference - взять маску прав из указанного файла;
-R - включить поддержку рекурсии;
--version - вывести версию утилиты;
```

```
u - владелец файла;
g - группа файла;
o - другие пользователи.

r - чтение.
w - запись.
x - выполнение.
s - выполнение для суперпользователя.
```

В качестве действий могут использоваться знаки "+" - включить или "-" - отключить.

Но права можно записывать не только таким способом:

```
0 - никаких прав;
1 - только выполнение;
2 - только запись;
3 - выполнение и запись;
4 - только чтение;
5 - чтение и выполнение;
6 - чтение и запись;
7 - чтение запись и выполнение.
```

Решение:

```sh
chmod 777 [file] 
```

**5) Как называется учётная запись встренного администратора в linux?**

Root - учетная запись встроенного администратора linux.

**6) Как выполнить команду от имени администратора?**

Способ 1: перейти в режим Root

1. Вводим команду:
```sh
su -
```
2. Вводим пароль от Root учетной записи.
3. Выполняем нужную команду.

Способ 2: использовать команду sudo

Пишем команду:
```sh
sudo [options] [command] [params]
```

*Флаги:*

```
-A или --askpass - по умолчанию sudo спрашивает пароль пользователя в терминале. Если задана эта опция, утилита попробует использовать графическую утилиту для запроса пароля.
-b или --background - запускает переданную программу в фоновом режиме;
-C или --close-from - опции нужно передать число больше трёх. Она позволяет закрыть для программы все файловые дескрипторы, кроме стандартного ввода и вывода;
-E или --preserve-env - позволяет передать переменные окружения текущего пользователя выполняемой программе. Также можно передать этой опции список переменных, которые нужно разрешить;
-e или --edit - позволяет редактировать файл вместо запуска команды. Файл копируется во временный каталог, редактируется с помощью редактора, установленного в системе по умолчанию, и если были изменения, записывается обратно с теми самыми правами;
-g - запустить команду с указанной группой вместо группы пользователя, от имени которого запускается программа;
-h - выполнить команду от имени другого хоста;
-H или --set-home - установить домашний каталог;
-i или --login - позволяет авторизоваться в консоли от имени другого пользователя. Будет выбран его домашний каталог, а также загружены все переменные окружения;
-k - по умолчанию, sudo сохраняет пароль и некоторое время после выполнения команды, вы можете выполнить ещё раз, без ввода пароля. Эта опция отключает такую возможность;
-l или --list - позволяет вывести список доступных команд для удалённых пользователей;
-n или --non-interactive - не интерактивный режим, если будет необходимо ввести пароль, программа выдаст ошибку;
-p или --prompt - использовать своё приглашение для ввода пароля;
-r или --role - выполнить программу с контекстом SELinux, у которого есть указанная роль;
-S - использовать стандартный поток ошибок для запроса пароля;
-s или --shell - позволяет запустить указанный командный интерпретатор;
-U или --User - вместе с опцией -l позволяет посмотреть привилегии для пользователя;
-T или --timeout - позволяет установить время выполнения команды, если время истечёт раньше, чем завершится команда, то она будет завершена принудительно;
-u - позволяет указать, от имени какого пользователя нужно выполнять программу;
-V - выводит версию утилиты;
-- - означает, что следующие опции обрабатывать не нужно.
```

Нюансы:

- Пользователь, от которого исходит команда sudo, должен быть в определенной группе для доступа к ее выполнению (wheel - ALT Linux, sudo - Ubuntu).
- Если группа администраторов не настроена должным образом, можно получить ошибку: [user] отсутствует в файле sudoers. Для настройки необходимо перейти в файлик /etc/sudoers и добавить строчку (для ALT Linux):
```sh
%wheel ALL=(ALL:ALL) ALL
```
Таким образом, мы добавляем все права для группы пользователей wheel.

**7) Есть ли ограничения у суперпользователя?**

Изначально все права доступа есть у Root пользователя с его собственным паролем, но если отредактировать файлик /etc/sudoers, можно добавлять полные права пользователям/группам. Тогда тот, кто имеем все права, может заходить под своими учетной записью и паролем, а затем использовать команду sudo.

**8) Удалите пользователя 2 с помощью пользователя 1.**

```sh
userdel [options] [user]
```

*Флаги:*

```
-f, --force - принудительное удаление, даже если пользователь еще залогинен.
-r, --remove - удалить домашнюю директорию пользователя и его файлы в системе.
-Z - удалить все SELinux объекты для этого пользователя.
```

**9) Как можно изменить владельца папки? измените владельца папки из пункта 4.**

```sh
chown [user] [options] [file_path]
```

*Флаги:*

```
-c, --changes - подробный вывод всех выполняемых изменений;
-f, --silent, --quiet - минимум информации, скрыть сообщения об ошибках;
--dereference - изменять права для файла к которому ведет символическая ссылка вместо самой ссылки (поведение по умолчанию);
-h, --no-dereference - изменять права символических ссылок и не трогать файлы, к которым они ведут;
--from - изменять пользователя только для тех файлов, владельцем которых является указанный пользователь и группа;
-R, --recursive - рекурсивная обработка всех подкаталогов;
-H - если передана символическая ссылка на директорию - перейти по ней;
-L - переходить по всем символическим ссылкам на директории;
-P - не переходить по символическим ссылкам на директории (по умолчанию).
```
Решение:

Смена владельца и группы каталога рекурсивно
```sh
chown -R [owner]:[group] ./[user_folder]
```
